"use strict";self.webpackHotUpdatereeval_screenity(471,{2483:(e,t,r)=>{function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function o(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */o=function(){return t};var e,t={},r=Object.prototype,a=r.hasOwnProperty,i=Object.defineProperty||function(e,t,r){e[t]=r.value},c="function"==typeof Symbol?Symbol:{},s=c.iterator||"@@iterator",u=c.asyncIterator||"@@asyncIterator",l=c.toStringTag||"@@toStringTag";function f(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{f({},"")}catch(e){f=function(e,t,r){return e[t]=r}}function h(e,t,r,n){var o=t&&t.prototype instanceof b?t:b,a=Object.create(o.prototype),c=new A(n||[]);return i(a,"_invoke",{value:S(e,r,c)}),a}function p(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=h;var d="suspendedStart",m="suspendedYield",v="executing",g="completed",y={};function b(){}function w(){}function x(){}var k={};f(k,s,(function(){return this}));var E=Object.getPrototypeOf,L=E&&E(E(N([])));L&&L!==r&&a.call(L,s)&&(k=L);var T=x.prototype=b.prototype=Object.create(k);function O(e){["next","throw","return"].forEach((function(t){f(e,t,(function(e){return this._invoke(t,e)}))}))}function j(e,t){function r(o,i,c,s){var u=p(e[o],e,i);if("throw"!==u.type){var l=u.arg,f=l.value;return f&&"object"==n(f)&&a.call(f,"__await")?t.resolve(f.__await).then((function(e){r("next",e,c,s)}),(function(e){r("throw",e,c,s)})):t.resolve(f).then((function(e){l.value=e,c(l)}),(function(e){return r("throw",e,c,s)}))}s(u.arg)}var o;i(this,"_invoke",{value:function(e,n){function a(){return new t((function(t,o){r(e,n,t,o)}))}return o=o?o.then(a,a):a()}})}function S(t,r,n){var o=d;return function(a,i){if(o===v)throw Error("Generator is already running");if(o===g){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var s=P(c,n);if(s){if(s===y)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===d)throw o=g,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=v;var u=p(t,r,n);if("normal"===u.type){if(o=n.done?g:m,u.arg===y)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=g,n.method="throw",n.arg=u.arg)}}}function P(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,P(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var a=p(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,y;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,y):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function I(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function _(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function A(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(I,this),this.reset(!0)}function N(t){if(t||""===t){var r=t[s];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function r(){for(;++o<t.length;)if(a.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return i.next=i}}throw new TypeError(n(t)+" is not iterable")}return w.prototype=x,i(T,"constructor",{value:x,configurable:!0}),i(x,"constructor",{value:w,configurable:!0}),w.displayName=f(x,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,x):(e.__proto__=x,f(e,l,"GeneratorFunction")),e.prototype=Object.create(T),e},t.awrap=function(e){return{__await:e}},O(j.prototype),f(j.prototype,u,(function(){return this})),t.AsyncIterator=j,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new j(h(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},O(T),f(T,l,"Generator"),f(T,s,(function(){return this})),f(T,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=N,A.prototype={constructor:A,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(_),!t)for(var r in this)"t"===r.charAt(0)&&a.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function n(n,o){return c.type="throw",c.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],c=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var s=a.call(i,"catchLoc"),u=a.call(i,"finallyLoc");if(s&&u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&a.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=e,i.arg=t,o?(this.method="next",this.next=o.finallyLoc,y):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),_(r),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;_(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:N(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),y}},t}function a(e,t,r,n,o,a,i){try{var c=e[a](i),s=c.value}catch(e){return void r(e)}c.done?t(s):Promise.resolve(s).then(n,o)}const i=function(){var e,t=(e=o().mark((function e(){var t;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,chrome.identity.getAuthToken({interactive:!0});case 3:if(t=e.sent){e.next=6;break}throw new Error("User cancelled sign-in or failed to get token");case 6:return e.next=8,new Promise((function(e){return chrome.storage.local.set({token:t.token},(function(){return e()}))}));case 8:return e.next=10,chrome.identity.getProfileUserInfo();case 10:return e.sent,e.abrupt("return",t.token);case 14:return e.prev=14,e.t0=e.catch(0),console.error("Error signing in:",e.t0.message),e.abrupt("return",null);case 19:case"end":return e.stop()}}),e,null,[[0,14]])})),function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function c(e){a(i,n,o,c,s,"next",e)}function s(e){a(i,n,o,c,s,"throw",e)}c(void 0)}))});return function(){return t.apply(this,arguments)}}();function c(e){return c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c(e)}function s(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */s=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",u=a.asyncIterator||"@@asyncIterator",l=a.toStringTag||"@@toStringTag";function f(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{f({},"")}catch(e){f=function(e,t,r){return e[t]=r}}function h(e,t,r,n){var a=t&&t.prototype instanceof b?t:b,i=Object.create(a.prototype),c=new A(n||[]);return o(i,"_invoke",{value:S(e,r,c)}),i}function p(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=h;var d="suspendedStart",m="suspendedYield",v="executing",g="completed",y={};function b(){}function w(){}function x(){}var k={};f(k,i,(function(){return this}));var E=Object.getPrototypeOf,L=E&&E(E(N([])));L&&L!==r&&n.call(L,i)&&(k=L);var T=x.prototype=b.prototype=Object.create(k);function O(e){["next","throw","return"].forEach((function(t){f(e,t,(function(e){return this._invoke(t,e)}))}))}function j(e,t){function r(o,a,i,s){var u=p(e[o],e,a);if("throw"!==u.type){var l=u.arg,f=l.value;return f&&"object"==c(f)&&n.call(f,"__await")?t.resolve(f.__await).then((function(e){r("next",e,i,s)}),(function(e){r("throw",e,i,s)})):t.resolve(f).then((function(e){l.value=e,i(l)}),(function(e){return r("throw",e,i,s)}))}s(u.arg)}var a;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return a=a?a.then(o,o):o()}})}function S(t,r,n){var o=d;return function(a,i){if(o===v)throw Error("Generator is already running");if(o===g){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var s=P(c,n);if(s){if(s===y)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===d)throw o=g,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=v;var u=p(t,r,n);if("normal"===u.type){if(o=n.done?g:m,u.arg===y)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=g,n.method="throw",n.arg=u.arg)}}}function P(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,P(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var a=p(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,y;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,y):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function I(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function _(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function A(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(I,this),this.reset(!0)}function N(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(c(t)+" is not iterable")}return w.prototype=x,o(T,"constructor",{value:x,configurable:!0}),o(x,"constructor",{value:w,configurable:!0}),w.displayName=f(x,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,x):(e.__proto__=x,f(e,l,"GeneratorFunction")),e.prototype=Object.create(T),e},t.awrap=function(e){return{__await:e}},O(j.prototype),f(j.prototype,u,(function(){return this})),t.AsyncIterator=j,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new j(h(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},O(T),f(T,l,"Generator"),f(T,i,(function(){return this})),f(T,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=N,A.prototype={constructor:A,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(_),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return c.type="throw",c.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var s=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(s&&u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,y):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),_(r),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;_(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:N(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),y}},t}function u(e,t,r,n,o,a,i){try{var c=e[a](i),s=c.value}catch(e){return void r(e)}c.done?t(s):Promise.resolve(s).then(n,o)}function l(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){u(a,n,o,i,c,"next",e)}function c(e){u(a,n,o,i,c,"throw",e)}i(void 0)}))}}const f=function(){var e=l(s().mark((function e(t,r,n){var o,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=function(){return a=l(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,t){chrome.storage.local.get(["token"],function(){var r=l(s().mark((function r(n){var o,a,c,u;return s().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!chrome.runtime.lastError){r.next=4;break}t(new Error(chrome.runtime.lastError)),r.next=24;break;case 4:if((o=n.token)&&null!==o){r.next=13;break}return r.next=8,i();case 8:(a=r.sent)&&null!==a||t(new Error("Sign-in failed")),e(a),r.next=24;break;case 13:r.prev=13,c=JSON.parse(atob(o.split(".")[1])),r.next=21;break;case 17:return r.prev=17,r.t0=r.catch(13),chrome.identity.getAuthToken({interactive:!0},(function(r){chrome.runtime.lastError?t(new Error(chrome.runtime.lastError)):e(r)})),r.abrupt("return");case 21:u=1e3*c.exp,Date.now()>=u?chrome.identity.getAuthToken({interactive:!0},(function(r){chrome.runtime.lastError?t(new Error(chrome.runtime.lastError)):e(r)})):e(o);case 24:case"end":return r.stop()}}),r,null,[[13,17]])})));return function(e){return r.apply(this,arguments)}}())})));case 1:case"end":return e.stop()}}),e)}))),a.apply(this,arguments)},o=function(){return a.apply(this,arguments)},e.abrupt("return",new Promise(function(){var e=l(s().mark((function e(a,i){var c,u,l,f,h,p,d,m;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,o();case 3:if((c=e.sent)&&null!==c){e.next=6;break}throw new Error("Sign-in failed");case 6:return u=new Headers({Authorization:"Bearer ".concat(c),"Content-Type":t.type}),e.next=9,fetch("https://www.googleapis.com/upload/drive/v3/files?uploadType=media",{method:"POST",headers:u,body:t});case 9:if((l=e.sent).ok){e.next=12;break}throw new Error("Error uploading to Google Drive: ".concat(l.status));case 12:return e.next=14,l.json();case 14:if(f=e.sent,h=f.id){e.next=18;break}throw new Error("File ID is undefined");case 18:return p={name:r},e.next=21,fetch("https://www.googleapis.com/drive/v3/files/".concat(h),{method:"PATCH",headers:new Headers({Authorization:"Bearer ".concat(c),"Content-Type":"application/json; charset=UTF-8"}),body:JSON.stringify(p)});case 21:if((d=e.sent).ok){e.next=28;break}return e.next=25,d.json();case 25:throw m=e.sent,console.error("Error updating file metadata:",d.status,m.error.message),new Error("Error updating file metadata: ".concat(d.status));case 28:n({status:"ok",url:h}),chrome.tabs.create({url:"https://drive.google.com/file/d/".concat(h,"/view")}),a("https://drive.google.com/file/d/".concat(h,"/view")),e.next=38;break;case 33:e.prev=33,e.t0=e.catch(0),console.error("Error uploading to Google Drive:",e.t0.message),n({status:"ew",url:null}),i(e.t0);case 38:case"end":return e.stop()}}),e,null,[[0,33]])})));return function(t,r){return e.apply(this,arguments)}}()));case 3:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}();function h(e){return h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},h(e)}function p(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a,i,c=[],s=!0,u=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;s=!1}else for(;!(s=(n=a.call(r)).done)&&(c.push(n.value),c.length!==t);s=!0);}catch(e){u=!0,o=e}finally{try{if(!s&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(u)throw o}}return c}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return d(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return d(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function m(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function v(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?m(Object(r),!0).forEach((function(t){g(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):m(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function g(e,t,r){var n;return n=function(e,t){if("object"!=h(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=h(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"),(t="symbol"==h(n)?n:n+"")in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function y(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */y=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",s=a.toStringTag||"@@toStringTag";function u(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,r){return e[t]=r}}function l(e,t,r,n){var a=t&&t.prototype instanceof b?t:b,i=Object.create(a.prototype),c=new A(n||[]);return o(i,"_invoke",{value:S(e,r,c)}),i}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=l;var p="suspendedStart",d="suspendedYield",m="executing",v="completed",g={};function b(){}function w(){}function x(){}var k={};u(k,i,(function(){return this}));var E=Object.getPrototypeOf,L=E&&E(E(N([])));L&&L!==r&&n.call(L,i)&&(k=L);var T=x.prototype=b.prototype=Object.create(k);function O(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function j(e,t){function r(o,a,i,c){var s=f(e[o],e,a);if("throw"!==s.type){var u=s.arg,l=u.value;return l&&"object"==h(l)&&n.call(l,"__await")?t.resolve(l.__await).then((function(e){r("next",e,i,c)}),(function(e){r("throw",e,i,c)})):t.resolve(l).then((function(e){u.value=e,i(u)}),(function(e){return r("throw",e,i,c)}))}c(s.arg)}var a;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return a=a?a.then(o,o):o()}})}function S(t,r,n){var o=p;return function(a,i){if(o===m)throw Error("Generator is already running");if(o===v){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var s=P(c,n);if(s){if(s===g)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===p)throw o=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=m;var u=f(t,r,n);if("normal"===u.type){if(o=n.done?v:d,u.arg===g)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=v,n.method="throw",n.arg=u.arg)}}}function P(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,P(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;var a=f(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,g;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,g):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function I(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function _(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function A(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(I,this),this.reset(!0)}function N(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(h(t)+" is not iterable")}return w.prototype=x,o(T,"constructor",{value:x,configurable:!0}),o(x,"constructor",{value:w,configurable:!0}),w.displayName=u(x,s,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,x):(e.__proto__=x,u(e,s,"GeneratorFunction")),e.prototype=Object.create(T),e},t.awrap=function(e){return{__await:e}},O(j.prototype),u(j.prototype,c,(function(){return this})),t.AsyncIterator=j,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new j(l(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},O(T),u(T,s,"Generator"),u(T,i,(function(){return this})),u(T,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=N,A.prototype={constructor:A,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(_),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return c.type="throw",c.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var s=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(s&&u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,g):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),_(r),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;_(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:N(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),g}},t}function b(e,t,r,n,o,a,i){try{var c=e[a](i),s=c.value}catch(e){return void r(e)}c.done?t(s):Promise.resolve(s).then(n,o)}function w(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){b(a,n,o,i,c,"next",e)}function c(e){b(a,n,o,i,c,"throw",e)}i(void 0)}))}}var x=function(){var e=w(y().mark((function e(t,r){var n,o,a,i=arguments;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=i.length>2&&void 0!==i[2]?i[2]:null,o=i.length>3&&void 0!==i[3]?i[3]:null,null!==t&&null!==r){e.next=4;break}return e.abrupt("return",Promise.reject(new Error("Tab ID or message is null")));case 4:return e.prev=4,e.next=7,new Promise((function(e,r){chrome.tabs.get(t,(function(t){chrome.runtime.lastError?r(chrome.runtime.lastError.message):e(t)}))}));case 7:if((a=e.sent)&&a.url&&!a.url.startsWith("chrome://")&&!a.url.startsWith("chromewebstore.google.com")&&!a.url.startsWith("chrome.google.com/webstore")&&""!==a.url&&"about:blank"!==a.url){e.next=10;break}return e.abrupt("return",Promise.reject(new Error("Invalid tab URL")));case 10:return e.abrupt("return",new Promise((function(e,t){chrome.tabs.sendMessage(a.id,r,(function(r){chrome.runtime.lastError?t(chrome.runtime.lastError.message):n?n(r):e(r)}))})));case 13:return e.prev=13,e.t0=e.catch(4),console.error("Error sending message to tab:",e.t0),o&&"function"==typeof o&&o(),e.abrupt("return",Promise.reject(e.t0));case 18:case"end":return e.stop()}}),e,null,[[4,13]])})));return function(t,r){return e.apply(this,arguments)}}(),k=function(){var e=w(y().mark((function e(t){var r;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==t){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,new Promise((function(e){chrome.tabs.get(t,(function(t){e(t)}))}));case 5:(r=e.sent)&&r.id&&chrome.windows.update(r.windowId,{focused:!0}).then((function(){chrome.tabs.update(r.id,{active:!0})})),e.next=11;break;case 9:e.prev=9,e.t0=e.catch(2);case 11:case"end":return e.stop()}}),e,null,[[2,9]])})));return function(t){return e.apply(this,arguments)}}(),E=function(){var e=w(y().mark((function e(t){var r;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==t){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,new Promise((function(e){chrome.tabs.get(t,(function(t){e(t)}))}));case 5:(r=e.sent)&&r.id&&chrome.tabs.remove(r.id),e.next=11;break;case 9:e.prev=9,e.t0=e.catch(2);case 11:case"end":return e.stop()}}),e,null,[[2,9]])})));return function(t){return e.apply(this,arguments)}}(),L=function(){var e=w(y().mark((function e(){var t,r,n,o,a=arguments;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=v({active:!0,lastFocusedWindow:!0},a.length>0&&void 0!==a[0]?a[0]:{}),e.next=4,chrome.tabs.query(t);case 4:return r=e.sent,n=p(r,1),o=n[0],e.abrupt("return",o);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),T=function(){var e=w(y().mark((function e(t){var r,n,o,a,i=arguments;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=i.length>1&&void 0!==i[1]&&i[1],n=i.length>2&&void 0!==i[2]&&i[2],t){e.next=4;break}return e.abrupt("return");case 4:r&&((a=chrome.i18n.getMessage("@@ui_locale")).includes("en")||(o="http://translate.google.com/translate?js=n&sl=auto&tl="+a+"&u="+t)),o&&chrome.tabs.create({url:o,active:n});case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),O=r(3790),j=r.n(O),S=(r(4692),r(4353)),P=r.n(S);function I(e){return P()("2024-04-01 ".concat(e),"YYYY-MM-DD HH:mm:ss.SSS")}function _(e){return new Promise((function(t){setTimeout(t,e)}))}function A(e){return A="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},A(e)}function N(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */N=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",s=a.toStringTag||"@@toStringTag";function u(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,r){return e[t]=r}}function l(e,t,r,n){var a=t&&t.prototype instanceof g?t:g,i=Object.create(a.prototype),c=new I(n||[]);return o(i,"_invoke",{value:O(e,r,c)}),i}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",m="completed",v={};function g(){}function y(){}function b(){}var w={};u(w,i,(function(){return this}));var x=Object.getPrototypeOf,k=x&&x(x(_([])));k&&k!==r&&n.call(k,i)&&(w=k);var E=b.prototype=g.prototype=Object.create(w);function L(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function T(e,t){function r(o,a,i,c){var s=f(e[o],e,a);if("throw"!==s.type){var u=s.arg,l=u.value;return l&&"object"==A(l)&&n.call(l,"__await")?t.resolve(l.__await).then((function(e){r("next",e,i,c)}),(function(e){r("throw",e,i,c)})):t.resolve(l).then((function(e){u.value=e,i(u)}),(function(e){return r("throw",e,i,c)}))}c(s.arg)}var a;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return a=a?a.then(o,o):o()}})}function O(t,r,n){var o=h;return function(a,i){if(o===d)throw Error("Generator is already running");if(o===m){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var s=j(c,n);if(s){if(s===v)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var u=f(t,r,n);if("normal"===u.type){if(o=n.done?m:p,u.arg===v)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=m,n.method="throw",n.arg=u.arg)}}}function j(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,j(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var a=f(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,v;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,v):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function P(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function I(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function _(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(A(t)+" is not iterable")}return y.prototype=b,o(E,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:y,configurable:!0}),y.displayName=u(b,s,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===y||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,u(e,s,"GeneratorFunction")),e.prototype=Object.create(E),e},t.awrap=function(e){return{__await:e}},L(T.prototype),u(T.prototype,c,(function(){return this})),t.AsyncIterator=T,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new T(l(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},L(E),u(E,s,"Generator"),u(E,i,(function(){return this})),u(E,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=_,I.prototype={constructor:I,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(P),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return c.type="throw",c.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var s=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(s&&u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,v):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),v},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),P(r),v}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;P(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:_(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),v}},t}function U(e,t,r,n,o,a,i){try{var c=e[a](i),s=c.value}catch(e){return void r(e)}c.done?t(s):Promise.resolve(s).then(n,o)}function D(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){U(a,n,o,i,c,"next",e)}function c(e){U(a,n,o,i,c,"throw",e)}i(void 0)}))}}function R(e){var t,r,n,o=2;for("undefined"!=typeof Symbol&&(r=Symbol.asyncIterator,n=Symbol.iterator);o--;){if(r&&null!=(t=e[r]))return t.call(e);if(n&&null!=(t=e[n]))return new F(t.call(e));r="@@asyncIterator",n="@@iterator"}throw new TypeError("Object is not async iterable")}function F(e){function t(e){if(Object(e)!==e)return Promise.reject(new TypeError(e+" is not an object."));var t=e.done;return Promise.resolve(e.value).then((function(e){return{value:e,done:t}}))}return F=function(e){this.s=e,this.n=e.next},F.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var r=this.s.return;return void 0===r?Promise.resolve({value:e,done:!0}):t(r.apply(this.s,arguments))},throw:function(e){var r=this.s.return;return void 0===r?Promise.reject(e):t(r.apply(this.s,arguments))}},new F(e)}function C(){return G.apply(this,arguments)}function G(){return G=D(N().mark((function e(){var t,r,n=arguments;return N().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:chrome.windows.WindowState.NORMAL,e.next=3,chrome.windows.create({});case 3:return r=e.sent,chrome.windows.update(r.id,{state:null!=t?t:chrome.windows.WindowState.FULLSCREEN}),e.abrupt("return",r);case 6:case"end":return e.stop()}}),e)}))),G.apply(this,arguments)}function M(e){return q.apply(this,arguments)}function q(){return(q=D(N().mark((function e(t){var r,n,o,a,i,c,s,u;return N().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,chrome.tabs.query({windowId:t});case 2:r=e.sent,n=r.filter((function(e){var t=e.url,r=e.pendingUrl;return["","chrome://newtab/","chrome://newtab"].includes(t||r)})),o=!1,a=!1,e.prev=6,c=R(n);case 8:return e.next=10,c.next();case 10:if(!(o=!(s=e.sent).done)){e.next=17;break}return u=s.value,e.next=14,chrome.tabs.remove(u.id);case 14:o=!1,e.next=8;break;case 17:e.next=23;break;case 19:e.prev=19,e.t0=e.catch(6),a=!0,i=e.t0;case 23:if(e.prev=23,e.prev=24,!o||null==c.return){e.next=28;break}return e.next=28,c.return();case 28:if(e.prev=28,!a){e.next=31;break}throw i;case 31:return e.finish(28);case 32:return e.finish(23);case 33:case"end":return e.stop()}}),e,null,[[6,19,23,33],[24,,28,32]])})))).apply(this,arguments)}function Y(e){return Y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Y(e)}function W(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function V(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?W(Object(r),!0).forEach((function(t){B(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):W(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function B(e,t,r){var n;return n=function(e,t){if("object"!=Y(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=Y(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"),(t="symbol"==Y(n)?n:n+"")in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function H(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=J(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,c=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){c=!0,a=e},f:function(){try{i||null==r.return||r.return()}finally{if(c)throw a}}}}function X(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a,i,c=[],s=!0,u=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;s=!1}else for(;!(s=(n=a.call(r)).done)&&(c.push(n.value),c.length!==t);s=!0);}catch(e){u=!0,o=e}finally{try{if(!s&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(u)throw o}}return c}}(e,t)||J(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function J(e,t){if(e){if("string"==typeof e)return K(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?K(e,t):void 0}}function K(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function z(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */z=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",s=a.toStringTag||"@@toStringTag";function u(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,r){return e[t]=r}}function l(e,t,r,n){var a=t&&t.prototype instanceof g?t:g,i=Object.create(a.prototype),c=new I(n||[]);return o(i,"_invoke",{value:O(e,r,c)}),i}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",m="completed",v={};function g(){}function y(){}function b(){}var w={};u(w,i,(function(){return this}));var x=Object.getPrototypeOf,k=x&&x(x(_([])));k&&k!==r&&n.call(k,i)&&(w=k);var E=b.prototype=g.prototype=Object.create(w);function L(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function T(e,t){function r(o,a,i,c){var s=f(e[o],e,a);if("throw"!==s.type){var u=s.arg,l=u.value;return l&&"object"==Y(l)&&n.call(l,"__await")?t.resolve(l.__await).then((function(e){r("next",e,i,c)}),(function(e){r("throw",e,i,c)})):t.resolve(l).then((function(e){u.value=e,i(u)}),(function(e){return r("throw",e,i,c)}))}c(s.arg)}var a;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return a=a?a.then(o,o):o()}})}function O(t,r,n){var o=h;return function(a,i){if(o===d)throw Error("Generator is already running");if(o===m){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var s=j(c,n);if(s){if(s===v)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var u=f(t,r,n);if("normal"===u.type){if(o=n.done?m:p,u.arg===v)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=m,n.method="throw",n.arg=u.arg)}}}function j(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,j(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var a=f(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,v;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,v):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function P(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function I(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function _(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(Y(t)+" is not iterable")}return y.prototype=b,o(E,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:y,configurable:!0}),y.displayName=u(b,s,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===y||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,u(e,s,"GeneratorFunction")),e.prototype=Object.create(E),e},t.awrap=function(e){return{__await:e}},L(T.prototype),u(T.prototype,c,(function(){return this})),t.AsyncIterator=T,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new T(l(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},L(E),u(E,s,"Generator"),u(E,i,(function(){return this})),u(E,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=_,I.prototype={constructor:I,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(P),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return c.type="throw",c.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var s=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(s&&u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,v):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),v},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),P(r),v}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;P(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:_(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),v}},t}function Z(e,t,r,n,o,a,i){try{var c=e[a](i),s=c.value}catch(e){return void r(e)}c.done?t(s):Promise.resolve(s).then(n,o)}function Q(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){Z(a,n,o,i,c,"next",e)}function c(e){Z(a,n,o,i,c,"throw",e)}i(void 0)}))}}function $(e){var t,r,n,o=2;for("undefined"!=typeof Symbol&&(r=Symbol.asyncIterator,n=Symbol.iterator);o--;){if(r&&null!=(t=e[r]))return t.call(e);if(n&&null!=(t=e[n]))return new ee(t.call(e));r="@@asyncIterator",n="@@iterator"}throw new TypeError("Object is not async iterable")}function ee(e){function t(e){if(Object(e)!==e)return Promise.reject(new TypeError(e+" is not an object."));var t=e.done;return Promise.resolve(e.value).then((function(e){return{value:e,done:t}}))}return ee=function(e){this.s=e,this.n=e.next},ee.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var r=this.s.return;return void 0===r?Promise.resolve({value:e,done:!0}):t(r.apply(this.s,arguments))},throw:function(e){var r=this.s.return;return void 0===r?Promise.reject(e):t(r.apply(this.s,arguments))}},new ee(e)}j().config({driver:j().INDEXEDDB,name:"screenity",version:1});var te=j().createInstance({name:"chunks"}),re=j().createInstance({name:"localDirectory"}),ne=function(){var e=Q(z().mark((function e(){var t,r,n,o;return z().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,chrome.storage.local.get(["recordingTab"]);case 2:return t=e.sent,r=t.recordingTab,e.next=6,chrome.storage.local.get(["offscreen"]);case 6:n=e.sent,o=n.offscreen,(null!=r||o)&&(chrome.storage.local.set({recording:!0}),ie());case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),oe=function(){var e=Q(z().mark((function e(){var t,r;return z().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"editor.html",navigator.userAgent.includes("Chrome/")&&parseInt(navigator.userAgent.match(/Chrome\/([0-9]+)/)[1],10)<=109&&"editorfallback.html",e.next=4,chrome.storage.local.get(["activeTab"]);case 4:t=e.sent,r=t.activeTab,chrome.tabs.get(r,(function(e){e&&chrome.windows.update(e.windowId,{focused:!0},Q(z().mark((function e(){var t;return z().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return chrome.tabs.update(r,{active:!0,selected:!0,highlighted:!0}),k(r),x(r,{type:"ready-to-record"}),e.next=5,chrome.storage.local.get(["countdown"]);case 5:t=e.sent,t.countdown?setTimeout((function(){ne()}),3500):setTimeout((function(){ne()}),500);case 8:case"end":return e.stop()}}),e)}))))}));case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),ae=function(){var e=Q(z().mark((function e(){var t,r;return z().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,chrome.storage.local.get(["activeTab"]);case 2:t=e.sent,r=t.activeTab,k(r).then(Q(z().mark((function e(){var t;return z().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return x(r,{type:"ready-to-record"}),e.next=3,chrome.storage.local.get(["countdown"]);case 3:t=e.sent,t.countdown?setTimeout((function(){ne()}),3e3):ie();case 6:case"end":return e.stop()}}),e)}))));case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),ie=function(){var e=Q(z().mark((function e(){var t,r,n,o,a,i,c;return z().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return chrome.storage.local.set({recordingStartTime:Date.now(),restarting:!1,recording:!0}),e.next=3,chrome.storage.local.get(["customRegion"]);case 3:return t=e.sent,r=t.customRegion,we(r?{type:"start-recording-tab",region:!0}:{type:"start-recording-tab"}),chrome.action.setIcon({path:"assets/recording-logo.png"}),e.next=9,chrome.storage.local.get(["alarm"]);case 9:return n=e.sent,o=n.alarm,e.next=13,chrome.storage.local.get(["alarmTime"]);case 13:a=e.sent,i=a.alarmTime,o&&(c=parseFloat(i),chrome.alarms.create("recording-alarm",{delayInMinutes:c/60}));case 16:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();chrome.commands.onCommand.addListener(function(){var e=Q(z().mark((function e(t){var r,n,o;return z().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("start-recording"!==t){e.next=7;break}return e.next=3,L();case 3:r=e.sent,!1===navigator.onLine&&!r.url.includes("/playground.html")&&!r.url.includes("/setup.html")||r.url.startsWith("chrome://")||r.url.startsWith("chrome-extension://")&&!r.url.includes("/playground.html")&&!r.url.includes("/setup.html")||r.url.includes("stackoverflow.com/")||r.url.includes("chrome.google.com/webstore")||r.url.includes("chromewebstore.google.com")?chrome.tabs.create({url:"playground.html",active:!0}).then((function(e){chrome.storage.local.set({activeTab:e.id}),chrome.tabs.onUpdated.addListener((function e(t,r,n){t===n.id&&"complete"===r.status&&(setTimeout((function(){x(n.id,{type:"start-stream"})}),500),chrome.tabs.onUpdated.removeListener(e))}))})):x(r.id,{type:"start-stream"}),e.next=19;break;case 7:if("cancel-recording"!==t){e.next=14;break}return e.next=10,L();case 10:n=e.sent,x(n.id,{type:"cancel-recording"}),e.next=19;break;case 14:if("pause-recording"!=t){e.next=19;break}return e.next=17,L();case 17:o=e.sent,x(o.id,{type:"pause-recording"});case 19:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());var ce=function(){var e=Q(z().mark((function e(t){var r,n,o,a,i,c;return z().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("recording-alarm"!==t.name){e.next=22;break}return e.next=3,chrome.storage.local.get(["recording"]);case 3:if(r=e.sent,!r.recording){e.next=21;break}return de(),e.next=9,chrome.storage.local.get(["recordingTab"]);case 9:return n=e.sent,o=n.recordingTab,x(o,{type:"stop-recording-tab"}),e.next=14,chrome.storage.local.get(["activeTab"]);case 14:return a=e.sent,i=a.activeTab,x(i,{type:"stop-recording-tab"}),e.next=19,L();case 19:c=e.sent,x(c.id,{type:"stop-recording-tab"});case 21:chrome.alarms.clear("recording-alarm");case 22:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),se=function(e){ce(e)},ue=function(){chrome.alarms.onAlarm.hasListener(se)||chrome.alarms.onAlarm.addListener(se)};chrome.permissions&&chrome.permissions.contains({permissions:["alarms"]},(function(e){e&&ue()}));var le=function(){var e=Q(z().mark((function e(t){var r,n,o,a,i,c,s,u,l,f,h,p,d,m,v,g,y,b,w,k;return z().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,chrome.storage.local.get(["recordingStartTime"]);case 2:return r=e.sent,n=r.recordingStartTime,e.next=6,chrome.tabs.get(t.tabId);case 6:return o=e.sent,e.next=9,chrome.storage.local.get(["recording"]);case 9:return a=e.sent,i=a.recording,e.next=13,chrome.storage.local.get(["restarting"]);case 13:if(c=e.sent,s=c.restarting,!i){e.next=32;break}return e.next=18,chrome.storage.local.get(["tabRecordedID"]);case 18:return u=e.sent,(l=u.tabRecordedID)&&l!==t.tabId?x(t.tabId,{type:"hide-popup-recording"}):o.url.includes("backup.html")&&o.url.includes("chrome-extension://")||chrome.storage.local.set({activeTab:t.tabId}),e.next=23,chrome.storage.local.get(["region"]);case 23:return f=e.sent,h=f.region,e.next=27,chrome.storage.local.get(["customRegion"]);case 27:p=e.sent,d=p.customRegion,h||d||x(t.tabId,{type:"recording-check"}),e.next=33;break;case 32:i||s||x(t.tabId,{type:"recording-ended"});case 33:if(!n){e.next=51;break}return e.next=36,chrome.storage.local.get(["alarm"]);case 36:if(m=e.sent,!m.alarm){e.next=49;break}return e.next=41,chrome.storage.local.get(["alarmTime"]);case 41:v=e.sent,g=v.alarmTime,y=parseFloat(g),b=Math.floor((Date.now()-n)/1e3),w=y-b,x(t.tabId,{type:"time",time:w}),e.next=51;break;case 49:k=Math.floor((Date.now()-n)/1e3),x(t.tabId,{type:"time",time:k});case 51:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();function fe(e){return new Promise((function(t,r){var n=new FileReader;n.onload=function(){t(n.result)},n.onerror=function(e){r(e)},n.readAsDataURL(e)}))}chrome.windows.onFocusChanged.addListener(function(){var e=Q(z().mark((function e(t){var r,n,o;return z().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t!==chrome.windows.WINDOW_ID_NONE){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,chrome.tabs.query({active:!0,windowId:t});case 4:r=e.sent,n=X(r,1),(o=n[0])&&le({tabId:o.id});case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),chrome.tabs.onActivated.addListener(function(){var e=Q(z().mark((function e(t){return z().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:le(t);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),chrome.tabs.onUpdated.addListener(function(){var e=Q(z().mark((function e(t,r,n){var o,a,i,c,s,u,l,f,h,p,d,m,v,g,y,b;return z().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("complete"!==r.status){e.next=44;break}return e.next=3,chrome.storage.local.get(["recording"]);case 3:return o=e.sent,a=o.recording,e.next=7,chrome.storage.local.get(["restarting"]);case 7:return i=e.sent,c=i.restarting,e.next=11,chrome.storage.local.get(["tabRecordedID"]);case 11:return s=e.sent,u=s.tabRecordedID,a||c?a&&u&&u===t&&x(t,{type:"recording-check",force:!0}):x(t,{type:"recording-ended"}),e.next=16,chrome.storage.local.get(["recordingStartTime"]);case 16:return l=e.sent,f=l.recordingStartTime,e.next=20,chrome.tabs.get(t);case 20:if(h=e.sent,!f){e.next=39;break}return e.next=24,chrome.storage.local.get(["alarm"]);case 24:if(p=e.sent,!p.alarm){e.next=37;break}return e.next=29,chrome.storage.local.get(["alarmTime"]);case 29:d=e.sent,m=d.alarmTime,v=parseFloat(m),g=Math.floor((Date.now()-f)/1e3),x(t,{type:"time",time:v-g}),e.next=39;break;case 37:y=Math.floor((Date.now()-f)/1e3),x(t,{type:"time",time:y});case 39:return e.next=41,chrome.commands.getAll();case 41:b=e.sent,x(t,{type:"commands",commands:b}),h.url.includes(chrome.runtime.getURL("playground.html"))&&"complete"===r.status&&x(h.id,{type:"toggle-popup"});case 44:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}());var he=function(){var e=Q(z().mark((function e(t){var r,n,o,a,i,c,s,u,l,f,h,p=arguments;return z().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=p.length>1&&void 0!==p[1]&&p[1],e.next=3,chrome.storage.local.get(["sendingChunks","sandboxTab"]);case 3:if(n=e.sent,o=n.sendingChunks,a=n.sandboxTab,!o){e.next=9;break}return console.warn("Chunks are already being sent, skipping..."),e.abrupt("return");case 9:return e.next=11,chrome.storage.local.set({sendingChunks:!0});case 11:if(0!==t.length){e.next=16;break}return e.next=14,chrome.storage.local.set({sendingChunks:!1});case 14:return x(a,{type:"make-video-tab",override:r}),e.abrupt("return");case 16:t.sort((function(e,t){return e.timestamp-t.timestamp})),i=0,c=10,3,1e3,s=t.length,x(a,{type:"chunk-count",count:s,override:r}),u=function(){var e=Q(z().mark((function e(t){var r,n=arguments;return z().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.length>1&&void 0!==n[1]?n[1]:0,e.prev=1,e.next=4,x(a,{type:"new-chunk-tab",chunks:t});case 4:if(e.sent){e.next=7;break}throw new Error("No response or failed response from tab.");case 7:e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),r<3?(console.error("Sending batch failed, retrying... Attempt ".concat(r+1),e.t0),setTimeout((function(){return u(t,r+1)}),1e3)):console.error("Maximum retry attempts reached for this batch.",e.t0);case 12:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(t){return e.apply(this,arguments)}}();case 24:if(!(i<s)){e.next=36;break}return l=Math.min(i+c,s),e.next=28,Promise.all(t.slice(i,l).map(function(){var e=Q(z().mark((function e(t,r){var n;return z().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fe(t.chunk);case 3:return n=e.sent,e.abrupt("return",{chunk:n,index:i+r});case 7:return e.prev=7,e.t0=e.catch(0),console.error("Error converting chunk to Base64",e.t0),e.abrupt("return",null);case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,r){return e.apply(this,arguments)}}()));case 28:if(f=e.sent,!((h=f.filter((function(e){return null!==e}))).length>0)){e.next=33;break}return e.next=33,u(h);case 33:i+=c,e.next=24;break;case 36:return e.next=38,chrome.storage.local.set({sendingChunks:!1});case 38:x(a,{type:"make-video-tab",override:r});case 39:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),pe=function(){var e=Q(z().mark((function e(){var t,r,n=arguments;return z().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]&&n[0],e.prev=1,r=[],e.next=5,te.iterate((function(e,t){r.push(e)}));case 5:he(r,t),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),chrome.runtime.reload();case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(){return e.apply(this,arguments)}}(),de=function(){var e=Q(z().mark((function e(){var t,r,n,o;return z().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return chrome.storage.local.set({restarting:!1}),e.next=3,chrome.storage.local.get(["recordingStartTime"]);case 3:return t=e.sent,r=t.recordingStartTime,n=Date.now()-r,42e4,0===r&&(n=0),chrome.storage.local.set({recording:!1,recordingDuration:n,tabRecordedID:null}),chrome.storage.local.set({recordingStartTime:0}),n>42e4?chrome.tabs.create({url:"editorfallback.html",active:!0},(function(e){chrome.tabs.onUpdated.addListener((function t(r,n,o){r===e.id&&"complete"===n.status&&(chrome.tabs.onUpdated.removeListener(t),chrome.storage.local.set({sandboxTab:e.id}),pe())}))})):chrome.tabs.create({url:"editor.html",active:!0},(function(e){chrome.tabs.onUpdated.addListener((function t(r,n,o){r===e.id&&"complete"===n.status&&(chrome.tabs.onUpdated.removeListener(t),chrome.storage.local.set({sandboxTab:e.id}),pe())}))})),chrome.action.setIcon({path:"assets/icon-34.png"}),e.next=14,chrome.storage.local.get(["wasRegion"]);case 14:o=e.sent,o.wasRegion&&chrome.storage.local.set({wasRegion:!1,region:!0}),chrome.alarms.clear("recording-alarm"),Le();case 19:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),me=function(){var e=Q(z().mark((function e(){var t,r,n;return z().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t="editor.html",e.next=3,chrome.storage.local.get(["sandboxTab"]);case 3:r=e.sent,n=r.sandboxTab,chrome.tabs.create({url:t,active:!0},(function(e){chrome.tabs.onUpdated.addListener((function t(r,o,a){r===e.id&&"complete"===o.status&&(chrome.tabs.onUpdated.removeListener(t),E(n),chrome.storage.local.set({sandboxTab:e.id}),pe(!0))}))}));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();chrome.runtime.onStartup.addListener((function(){console.log("Starting...")})),chrome.action.onClicked.addListener(function(){var e=Q(z().mark((function e(t){var r,n,o,a,i;return z().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("action",t),e.next=3,chrome.storage.local.get(["recording"]);case 3:if(r=e.sent,!r.recording){e.next=15;break}return de(),we({type:"stop-recording-tab"}),e.next=10,chrome.storage.local.get(["activeTab"]);case 10:n=e.sent,o=n.activeTab,chrome.tabs.get(o,(function(e){e?x(o,{type:"stop-recording-tab"}):(x(t.id,{type:"stop-recording-tab"}),chrome.storage.local.set({activeTab:t.id}))})),e.next=16;break;case 15:!1===navigator.onLine&&!t.url.includes("/playground.html")&&!t.url.includes("/setup.html")||t.url.startsWith("chrome://")||t.url.startsWith("chrome-extension://")&&!t.url.includes("/playground.html")&&!t.url.includes("/setup.html")||t.url.includes("stackoverflow.com/")||t.url.includes("chrome.google.com/webstore")||t.url.includes("chromewebstore.google.com")?chrome.tabs.create({url:"playground.html",active:!0}).then((function(e){chrome.storage.local.set({activeTab:e.id})})):(x(t.id,{type:"toggle-popup"}),chrome.storage.local.set({activeTab:t.id}));case 16:return e.next=18,chrome.storage.local.get(["firstTime"]);case 18:if(a=e.sent,!a.firstTime||!t.url.includes(chrome.runtime.getURL("setup.html"))){e.next=26;break}return chrome.storage.local.set({firstTime:!1}),e.next=24,L();case 24:i=e.sent,x(i.id,{type:"setup-complete"});case 26:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());var ve=function(){var e=Q(z().mark((function e(){var t;return z().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,L();case 2:t=e.sent,x(t.id,{type:"ready-to-record"});case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),ge=function(){var e=Q(z().mark((function e(){var t,r,n,o,a,i,c,s;return z().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,chrome.storage.local.get(["micActive","defaultAudioInput","defaultAudioOutput","defaultVideoInput","systemAudio","recordingType","ReEvalProductionOption"]);case 2:return t=e.sent,r=t.micActive,n=t.defaultAudioInput,o=t.defaultAudioOutput,a=t.defaultVideoInput,i=t.systemAudio,c=t.recordingType,s=t.ReEvalProductionOption,e.abrupt("return",{micActive:r,defaultAudioInput:n,defaultAudioOutput:o,defaultVideoInput:a,systemAudio:i,recordingType:c,ReEvalProductionOption:s});case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),ye=function(){var e=Q(z().mark((function e(){var t,r;return z().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return chrome.storage.local.set({restarting:!0}),e.next=3,chrome.storage.local.get(["region"]);case 3:return t=e.sent,t.region,e.next=7,chrome.storage.local.get(["wasRegion"]);case 7:r=e.sent,r.wasRegion&&chrome.storage.local.set({wasRegion:!1,region:!0}),chrome.action.setIcon({path:"assets/icon-34.png"});case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),be=function(){var e=Q(z().mark((function e(){return z().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:chrome.storage.local.set({restarting:!0}),"editor.html",navigator.userAgent.includes("Chrome/")&&parseInt(navigator.userAgent.match(/Chrome\/([0-9]+)/)[1],10)<=109&&"editorfallback.html",ae();case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),we=function(){var e=Q(z().mark((function e(t){return z().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:chrome.storage.local.get(["recordingTab","offscreen"],(function(e){e.offscreen?chrome.runtime.sendMessage(t):x(e.recordingTab,t)}));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),xe=function(){var e=Q(z().mark((function e(t,r){var n,o,a;return z().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,chrome.storage.local.get(["backupTab"]);case 2:n=e.sent,o=n.backupTab,a=chrome.runtime.getURL("backup.html"),o?chrome.tabs.get(o,(function(e){e?x(e.id,{type:"init-backup",request:t,tabId:r}):chrome.tabs.create({url:a,active:!0,pinned:!0,index:0},(function(e){chrome.storage.local.set({backupTab:e.id}),chrome.tabs.onUpdated.addListener((function n(o,a,i){o===e.id&&"complete"===a.status&&(x(e.id,{type:"init-backup",request:t,tabId:r}),chrome.tabs.onUpdated.removeListener(n))}))}))})):chrome.tabs.create({url:a,active:!0,pinned:!0,index:0},(function(e){chrome.storage.local.set({backupTab:e.id}),chrome.tabs.onUpdated.addListener((function n(o,a,i){o===e.id&&"complete"===a.status&&(x(e.id,{type:"init-backup",request:t,tabId:r}),chrome.tabs.onUpdated.removeListener(n))}))}));case 6:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),ke=function(){var e=Q(z().mark((function e(t){var r,n,o,a,i,c,s,u,l,f,h,p=arguments;return z().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=p.length>1&&void 0!==p[1]?p[1]:null,e.next=3,chrome.storage.local.get(["backup"]);case 3:return n=e.sent,o=n.backup,e.next=7,L();case 7:if(a=e.sent,null===r){e.next=12;break}return e.next=11,chrome.tabs.get(r);case 11:a=e.sent;case 12:return chrome.storage.local.set({activeTab:a.id,tabRecordedID:null,memoryError:!1}),a.url.includes(chrome.runtime.getURL("playground.html"))?chrome.storage.local.set({tabPreferred:!0}):chrome.storage.local.set({tabPreferred:!1}),e.prev=14,e.next=17,chrome.runtime.getContexts({});case 17:if(i=e.sent,!i.find((function(e){return"OFFSCREEN_DOCUMENT"===e.contextType}))){e.next=22;break}return e.next=22,chrome.offscreen.closeDocument();case 22:e.next=26;break;case 24:e.prev=24,e.t0=e.catch(14);case 26:if(!t.region){e.next=43;break}if(null!==r&&chrome.tabs.update(r,{active:!0}),chrome.storage.local.set({recordingTab:a.id,offscreen:!1,region:!0}),!t.customRegion){e.next=33;break}we({type:"loaded",request:t,backup:o,region:!0}),e.next=41;break;case 33:throw e.prev=33,new Error("Exit offscreen recording");case 37:e.prev=37,e.t1=e.catch(33),console.log("798->",e.t1),chrome.tabs.create({url:"recorder.html",pinned:!0,index:0,active:!!a.url.includes(chrome.runtime.getURL("playground.html"))}).then((function(e){chrome.storage.local.set({recordingTab:e.id,offscreen:!1,region:!1,wasRegion:!0,tabRecordedID:a.id}),chrome.tabs.onUpdated.addListener((function r(n,i,c){n===e.id&&"complete"===i.status&&(chrome.tabs.onUpdated.removeListener(r),we({type:"loaded",request:t,tabID:a.id,backup:o,isTab:!0}))}))}));case 41:e.next=74;break;case 43:if(e.prev=43,t.offscreenRecording&&!t.camera){e.next=46;break}throw new Error("Exit offscreen recording");case 46:return null!==r&&chrome.tabs.update(r,{active:!0}),e.next=49,chrome.storage.local.get(["qualityValue"]);case 49:return c=e.sent,s=c.qualityValue,e.next=53,chrome.storage.local.get(["fpsValue"]);case 53:return u=e.sent,l=u.fpsValue,e.next=57,chrome.runtime.getContexts({});case 57:if(f=e.sent,!f.find((function(e){return"OFFSCREEN_DOCUMENT"===e.contextType}))){e.next=62;break}return e.next=62,chrome.offscreen.closeDocument();case 62:return e.next=64,chrome.offscreen.createDocument({url:"recorderoffscreen.html",reasons:["USER_MEDIA","AUDIO_PLAYBACK","DISPLAY_MEDIA"],justification:"Recording from getDisplayMedia API"});case 64:chrome.storage.local.set({recordingTab:null,offscreen:!0,region:!1,wasRegion:!1}),we({type:"loaded",request:t,isTab:!1,quality:s,fps:l,backup:o}),e.next=74;break;case 68:e.prev=68,e.t2=e.catch(43),console.log("798->",e.t2),h=!0,t.camera&&(h=!1),chrome.tabs.create({url:"recorder.html",pinned:!0,index:0,active:h}).then((function(e){chrome.storage.local.set({recordingTab:e.id,offscreen:!1,region:!1,wasRegion:!1}),chrome.tabs.onUpdated.addListener((function r(n,a,i){n===e.id&&"complete"===a.status&&(chrome.tabs.onUpdated.removeListener(r),we({type:"loaded",request:t,backup:o}))}))}));case 74:case"end":return e.stop()}}),e,null,[[14,24],[33,37],[43,68]])})));return function(t){return e.apply(this,arguments)}}(),Ee=function(){var e=Q(z().mark((function e(){var t,r;return z().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,chrome.storage.local.get(["sandboxTab"]);case 2:t=e.sent,r=t.sandboxTab,x(r,{type:"saved-to-drive"});case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Le=function(){var e=Q(z().mark((function e(){var t;return z().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,chrome.runtime.getContexts({});case 3:if(t=e.sent,!t.find((function(e){return"OFFSCREEN_DOCUMENT"===e.contextType}))){e.next=8;break}return e.next=8,chrome.offscreen.closeDocument();case 8:e.next=12;break;case 10:e.prev=10,e.t0=e.catch(0);case 12:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(){return e.apply(this,arguments)}}(),Te=function(){var e=Q(z().mark((function e(){var t,r,n,o,a,i,c,s,u,l,f;return z().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=chrome.runtime.getManifest().content_scripts,r=t.map((function(e){return chrome.tabs.query({url:e.matches})})),e.next=4,Promise.all(r);case 4:for(n=e.sent,o=[],a=0;a<n.length;a++){i=n[a],c=t[a],s=H(i);try{for(s.s();!(u=s.n()).done;)l=u.value,f=chrome.scripting.executeScript({target:{tabId:l.id},files:c.js},(function(){return chrome.runtime.lastError})),o.push(f)}catch(e){s.e(e)}finally{s.f()}}return e.next=9,Promise.all(o);case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();chrome.runtime.onInstalled.addListener(function(){var e=Q(z().mark((function e(t){var r,n,o,a;return z().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"install"===t.reason?(chrome.storage.local.clear(),(r=chrome.i18n.getMessage("@@ui_locale")).includes("en")?chrome.runtime.setUninstallURL("https://tally.so/r/w8Zro5?version="+chrome.runtime.getManifest().version):chrome.runtime.setUninstallURL("http://translate.google.com/translate?js=n&sl=auto&tl="+r+"&u=https://tally.so/r/w8Zro5?version="+chrome.runtime.getManifest().version),chrome.storage.local.set({firstTime:!0}),chrome.tabs.create({url:"setup.html"})):"update"===t.reason&&("2.8.6"===t.previousVersion?(chrome.storage.local.clear(),chrome.storage.local.set({updatingFromOld:!0})):chrome.storage.local.set({updatingFromOld:!1}),(n=chrome.i18n.getMessage("@@ui_locale")).includes("en")?chrome.runtime.setUninstallURL("https://tally.so/r/3Ex6kX?version="+chrome.runtime.getManifest().version):chrome.runtime.setUninstallURL("http://translate.google.com/translate?js=n&sl=auto&tl="+n+"&u=https://tally.so/r/3Ex6kX?version="+chrome.runtime.getManifest().version)),navigator.userAgent.includes("Chrome/")&&parseInt(navigator.userAgent.match(/Chrome\/([0-9]+)/)[1],10)<=109&&chrome.storage.local.set({backup:!1}),chrome.storage.local.set({systemAudio:!0}),e.next=5,chrome.storage.local.get(["backupTab"]);case 5:o=e.sent,(a=o.backupTab)&&E(a),Te();case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),chrome.tabs.onRemoved.addListener(function(){var e=Q(z().mark((function e(t,r){var n,o,a,i,c,s,u,l,f;return z().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,chrome.storage.local.get(["region"]);case 2:if(n=e.sent,!n.region){e.next=6;break}return e.abrupt("return");case 6:return e.next=8,chrome.storage.local.get(["recordingTab"]);case 8:return o=e.sent,a=o.recordingTab,e.next=12,chrome.storage.local.get(["recording"]);case 12:return i=e.sent,c=i.recording,e.next=16,chrome.storage.local.get(["restarting"]);case 16:if(s=e.sent,u=s.restarting,t!==a||u){e.next=26;break}return chrome.storage.local.set({recordingTab:null}),e.next=22,chrome.storage.local.get(["activeTab"]);case 22:l=e.sent,f=l.activeTab;try{c&&k(f),x(f,{type:"stop-recording-tab"},null,(function(){x(t,{type:"stop-recording-tab"}),chrome.storage.local.set({activeTab:t})}))}catch(e){x(t,{type:"stop-recording-tab"}),chrome.storage.local.set({activeTab:t})}chrome.action.setIcon({path:"assets/icon-34.png"});case 26:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}());var Oe=function(){var e=Q(z().mark((function e(){return z().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:we({type:"dismiss-recording"}),chrome.action.setIcon({path:"assets/icon-34.png"}),Le(),chrome.storage.local.set({recordingTab:null,sandboxTab:null,recording:!1}),chrome.runtime.sendMessage({type:"discard-backup"});case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),je=function(){var e=Q(z().mark((function e(){var t,r,n,o,a;return z().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,chrome.storage.local.get(["recordingTab"]);case 2:return t=e.sent,r=t.recordingTab,e.next=6,chrome.storage.local.get(["offscreen"]);case 6:if(n=e.sent,o=n.offscreen,!r||o){e.next=12;break}try{chrome.tabs.get(r,(function(e){e||Oe()}))}catch(e){Oe()}e.next=18;break;case 12:if(!o){e.next=18;break}return e.next=15,chrome.runtime.getContexts({});case 15:a=e.sent,a.find((function(e){return"OFFSCREEN_DOCUMENT"===e.contextType}))||Oe();case 18:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Se=function(){var e=Q(z().mark((function e(){return z().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:ae();case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Pe=function(){var e=Q(z().mark((function e(t,r){return z().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:chrome.tabs.create({url:"download.html",active:!1},(function(e){chrome.tabs.onUpdated.addListener((function n(o,a,i){o===e.id&&"complete"===a.status&&(chrome.tabs.onUpdated.removeListener(n),x(e.id,{type:"download-video",base64:t,title:r}))}))}));case 1:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),Ie=function(){var e=Q(z().mark((function e(){return z().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:chrome.tabs.create({url:"download.html",active:!1},(function(e){chrome.tabs.onUpdated.addListener((function t(r,n,o){r===e.id&&"complete"===n.status&&(chrome.tabs.onUpdated.removeListener(t),x(e.id,{type:"download-indexed-db"}))}))}));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),_e=function(){var e=Q(z().mark((function e(){var t,r;return z().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t="editorfallback.html",navigator.userAgent.includes("Chrome/")&&parseInt(navigator.userAgent.match(/Chrome\/([0-9]+)/)[1],10)<=109&&(t="editorfallback.html"),r=[],e.next=5,te.iterate((function(e,t){r.push(e)}));case 5:if(0!==r.length){e.next=7;break}return e.abrupt("return");case 7:chrome.tabs.create({url:t,active:!0},function(){var e=Q(z().mark((function e(t){return z().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return chrome.storage.local.set({sandboxTab:t.id}),e.next=3,new Promise((function(e){chrome.tabs.onUpdated.addListener((function(e,r){"complete"===r.status&&e===t.id&&(x(t.id,{type:"restore-recording"}),pe())}))}));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Ae=function(){var e=Q(z().mark((function e(t){var r;return z().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=[],e.next=3,te.iterate((function(e,t){r.push(e)}));case 3:if(0!==r.length){e.next=6;break}return t({restore:!1,chunks:[]}),e.abrupt("return");case 6:t({restore:!0});case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Ne=function(e){var t=e.match(/^data:(.*?);base64,/);if(null!==t){for(var r=t[1],n=atob(e.slice(t[0].length)),o=new Uint8Array(n.length),a=0;a<n.length;a++)o[a]=n.charCodeAt(a);return new Blob([o],{type:r})}for(var i=atob(e),c=new Uint8Array(i.length),s=0;s<i.length;s++)c[s]=i.charCodeAt(s);return new Blob([c],{type:"video/webm"})},Ue=function(){var e=Q(z().mark((function e(t,r){var n,o,a,i,c,s,u,l,h,p,d=arguments;return z().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(d.length>2&&void 0!==d[2]&&d[2]){e.next=7;break}n=Ne(r.base64),o=r.title+".mp4",f(n,o,t).then((function(){Ee()})),e.next=25;break;case 7:return a=[],e.next=10,te.iterate((function(e,t){a.push(e)}));case 10:i=[],c=0,s=0,u=a;case 13:if(!(s<u.length)){e.next=22;break}if(!((l=u[s]).timestamp<c)){e.next=17;break}return e.abrupt("continue",19);case 17:c=l.timestamp,i.push(l.chunk);case 19:s++,e.next=13;break;case 22:h=new Blob(i,{type:"video/webm"}),p=r.title+".webm",f(h,p,t).then((function(){Ee()}));case 25:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),De=function(){var e=Q(z().mark((function e(t){var r,n,o,a,i;return z().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,chrome.storage.local.get(["backup"]);case 2:return r=e.sent,n=r.backup,e.next=6,chrome.storage.local.get(["backupSetup"]);case 6:if(o=e.sent,a=o.backupSetup,chrome.storage.local.set({sendingChunks:!1}),!n){e.next=17;break}return a||re.clear(),e.next=13,L();case 13:i=e.sent,xe(t,i.id),e.next=18;break;case 17:ke(t);case 18:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Re=function(){var e=Q(z().mark((function e(t){var r,n;return z().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,chrome.storage.local.get(["backupTab"]);case 2:r=e.sent,(n=r.backupTab)?x(n,{type:"write-file",index:t.index},null,(function(){we({type:"stop-recording-tab"})})):we({type:"stop-recording-tab"});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Fe=function(){var e=Q(z().mark((function e(){var t,r;return z().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,chrome.storage.local.get(["backupTab"]);case 2:t=e.sent,(r=t.backupTab)&&x(r,{type:"close-writable"}),de();case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Ce=function(){var e=Q(z().mark((function e(t,r){var n,o;return z().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,chrome.storage.local.get(["sandboxTab"]);case 2:n=e.sent,o=n.sandboxTab,x(o,{type:"new-chunk-tab",chunk:t.chunk,index:t.index}),r({status:"ok"});case 6:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),Ge=function(){var e=Q(z().mark((function e(){var t;return z().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ge();case 2:t=e.sent,we({type:"streaming-data",data:JSON.stringify(t)});case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Me=function(){var e=Q(z().mark((function e(){var t,r;return z().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return chrome.action.setIcon({path:"assets/icon-34.png"}),e.next=3,chrome.storage.local.get(["activeTab"]);case 3:t=e.sent,r=t.activeTab,x(r,{type:"stop-pending"}),k(r),Le();case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),qe=function(){var e=Q(z().mark((function e(t){return z().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.memoryError&&chrome.storage.local.set({recording:!1,restarting:!1,tabRecordedID:null,memoryError:!0}),we({type:"stop-recording-tab"});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Ye=function(){var e=Q(z().mark((function e(){return z().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),We=function(){var e=Q(z().mark((function e(){return z().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:chrome.runtime.sendMessage({type:"discard-backup"}),Oe();case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Ve=function(){var e=Q(z().mark((function e(t){return z().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:chrome.storage.local.get(["region"],(function(e){e.region&&we({type:"set-mic-active-tab",active:t.active,defaultAudioInput:t.defaultAudioInput})}));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Be=function(){var e=Q(z().mark((function e(t){var r,n,o,a,i,c;return z().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,chrome.storage.local.get(["activeTab"]);case 2:return r=e.sent,n=r.activeTab,we({type:"recording-error"}).then((function(){x(n,{type:"stop-pending"}),k(n),"stream-error"===t.error?x(n,{type:"stream-error"}):"backup-error"===t.error&&x(n,{type:"backup-error"})})),e.next=7,chrome.storage.local.get(["recordingTab"]);case 7:return o=e.sent,a=o.recordingTab,e.next=11,chrome.storage.local.get(["region"]);case 11:i=e.sent,c=i.region,a&&!c&&E(a),chrome.storage.local.set({recordingTab:null}),Le();case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),He=function(){var e=Q(z().mark((function e(t){var r;return z().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,L();case 2:(r=e.sent)&&x(r.id,{type:"on-get-permissions",data:t});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Xe=function(){var e=Q(z().mark((function e(){var t,r;return z().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,chrome.storage.local.get(["recordingTab"]);case 2:t=e.sent,(r=t.recordingTab)&&chrome.tabs.get(r,(function(e){e&&e.url.includes("chrome-extension")&&e.url.includes("recorder.html")&&E(r)}));case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Je=function(){var e=Q(z().mark((function e(t){var r,n;return z().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return chrome.storage.local.set({surface:t.surface}),e.next=3,chrome.storage.local.get(["activeTab"]);case 3:r=e.sent,n=r.activeTab,x(n,{type:"set-surface",surface:t.surface});case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Ke=function(){var e=Q(z().mark((function e(){var t,r,n,o=arguments;return z().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=o.length>0&&void 0!==o[0]&&o[0],e.next=3,chrome.storage.local.get(["activeTab"]);case 3:r=e.sent,n=r.activeTab,x(n,t?{type:"pip-started"}:{type:"pip-ended"});case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),ze=function(){var e=Q(z().mark((function e(){var t,r;return z().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,chrome.storage.local.get(["token"]);case 2:t=e.sent,r=t.token,fetch("https://accounts.google.com/o/oauth2/revoke?token="+r),chrome.identity.removeCachedAuthToken({token:r}),chrome.storage.local.set({token:!1});case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Ze=function(){var e=Q(z().mark((function e(t){var r,n;return z().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return chrome.storage.local.set({recording:!1,restarting:!1,tabRecordedID:null,memoryError:!0}),we({type:"stop-recording-tab"}),e.next=4,chrome.storage.local.get(["activeTab"]);case 4:r=e.sent,n=r.activeTab,x(n,{type:"stop-pending"}),k(n);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Qe=function(){var e=Q(z().mark((function e(){return z().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:te.clear();case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),$e=function(){var e=Q(z().mark((function e(t,r){return z().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==t&&0!==r){e.next=2;break}return e.abrupt("return");case 2:chrome.windows.getCurrent((function(e){chrome.windows.update(e.id,{width:t,height:r})}));case 3:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}();function et(e,t){var r=new URL(e);return r.searchParams.set("reeval",t),r.toString()}chrome.runtime.onMessage.addListener((function(e,t,r){if("desktop-capture"===e.type)De(e);else if("backup-created"===e.type)ke(e.request,e.tabId);else if("write-file"===e.type)Re(e);else if("handle-restart"===e.type)be();else if("handle-dismiss"===e.type)ye();else if("reset-active-tab"===e.type)oe();else if("reset-active-tab-restart"===e.type)ae();else if("start-rec"===e.type)ie();else if("video-ready"===e.type)Fe();else if("start-recording"===e.type)ie();else if("restarted"===e.type)ve();else{if("new-chunk"===e.type)return Ce(e,r),!0;if("get-streaming-data"===e.type)Ge();else if("cancel-recording"===e.type)Me();else if("stop-recording-tab"===e.type)qe(e);else if("restart-recording-tab"===e.type)Ye();else if("dismiss-recording-tab"===e.type)We();else if("pause-recording-tab"===e.type)we({type:"pause-recording-tab"});else if("resume-recording-tab"===e.type)we({type:"resume-recording-tab"});else if("set-mic-active-tab"===e.type)Ve(e);else if("recording-error"===e.type)Be(e);else if("on-get-permissions"===e.type)He(e);else if("recording-complete"===e.type)Xe();else if("check-recording"===e.type)je();else if("review-screenity"===e.type)T("https://chrome.google.com/webstore/detail/screenity-screen-recorder/kbbdabhdfibnancpjfhlkhafgdilcnji/reviews",!1,!0);else if("follow-twitter"===e.type)T("https://alyssax.substack.com/",!1,!0);else if("open-processing-info"===e.type)T("https://help.screenity.io/editing-and-exporting/dJRFpGq56JFKC7k8zEvsqb/why-is-there-a-5-minute-limit-for-editing/ddy4e4TpbnrFJ8VoRT37tQ",!0,!0);else if("upgrade-info"===e.type)T("https://help.screenity.io/getting-started/77KizPC8MHVGfpKpqdux9D/what-are-the-technical-requirements-for-using-screenity/6kdB6qru6naVD8ZLFvX3m9",!0,!0);else if("trim-info"===e.type)T("https://help.screenity.io/editing-and-exporting/dJRFpGq56JFKC7k8zEvsqb/how-to-cut-trim-or-mute-parts-of-your-video/svNbM7YHYY717MuSWXrKXH",!0,!0);else if("join-waitlist"===e.type)T("https://tally.so/r/npojNV",!0,!0);else if("chrome-update-info"===e.type)T("https://help.screenity.io/getting-started/77KizPC8MHVGfpKpqdux9D/what-are-the-technical-requirements-for-using-screenity/6kdB6qru6naVD8ZLFvX3m9",!0,!0);else if("set-surface"===e.type)Je(e);else if("pip-ended"===e.type)Ke(!1);else if("pip-started"===e.type)Ke(!0);else if("new-sandbox-page-restart"===e.type)Se();else if("sign-out-drive"===e.type)ze();else if("open-help"===e.type)T("https://help.screenity.io/",!0,!0);else if("memory-limit-help"===e.type)T("https://help.screenity.io/troubleshooting/9Jy5RGjNrBB42hqUdREQ7W/what-does-%E2%80%9Cmemory-limit-reached%E2%80%9D-mean-when-recording/8WkwHbt3puuXunYqQnyPcb",!0,!0);else if("open-home"===e.type)T("https://screenity.io/",!1,!0);else if("report-bug"===e.type)T("https://tally.so/r/3ElpXq?version="+chrome.runtime.getManifest().version,!1,!0);else if("clear-recordings"===e.type)Qe();else if("force-processing"===e.type)me();else if("focus-this-tab"===e.type)k(t.tab.id);else if("stop-recording-tab-backup"===e.type)Ze(e);else if("indexed-db-download"===e.type)Ie();else{if("get-platform-info"===e.type)return function(e){chrome.runtime.getPlatformInfo((function(t){e(t)}))}(r),!0;if("restore-recording"===e.type)_e();else{if("check-restore"===e.type)return Ae(r),!0;if("check-capture-permissions"===e.type)return chrome.permissions.contains({permissions:["desktopCapture","alarms","offscreen"]},(function(e){e?r({status:"ok"}):chrome.permissions.request({permissions:["desktopCapture","alarms","offscreen"]},(function(e){e?(ue(),r({status:"ok"})):r({status:"error"})}))})),!0;if("is-pinned"===e.type)return function(e){chrome.action.getUserSettings().then((function(t){e({pinned:t.isOnToolbar})}))}(r),!0;if("save-to-drive"===e.type)return Ue(r,e,!1),!0;if("save-to-drive-fallback"===e.type)return Ue(r,e,!0),!0;if("request-download"===e.type)Pe(e.base64,e.title);else if("resize-window"===e.type)$e(e.width,e.height);else{if("available-memory"===e.type)return function(e){navigator.storage.estimate().then((function(t){e({data:t})}))}(r),!0;"extension-media-permissions"===e.type?T("chrome://settings/content/siteDetails?site=chrome-extension://"+chrome.runtime.id,!1,!0):"add-alarm-listener"===e.type&&ue()}}}}})),chrome.runtime.onMessage.addListener(function(){var e=Q(z().mark((function e(t,r,n){var o,a,i,c,s,u,l,f,h,p,d,m,v,g,y,b,w,x,k,E,T,O,j,S,P,A,N,U,D,R,F,G,q,Y,W,B,H,J,K,Z,Q,ee,te,re,ne,oe,ae;return z().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=t.type,a=t.options,"reeval"!==o){e.next=82;break}return i=new Map,c=[],s=a.map((function(e,t){var r=et(e.target,t);return V(V({},e),{},{url:r})})),e.next=7,_(1e4);case 7:e.prev=7,u=!1,l=!1,e.prev=10,h=z().mark((function e(){var t,r,n,o,a;return z().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=d.value,n=t.url,t.inx,e.next=4,chrome.tabs.query({url:n});case 4:if(o=e.sent,a=null==o?void 0:o[0],null!=o&&o.length){e.next=12;break}return Number(new Date),e.next=10,chrome.tabs.create({url:n,active:!1});case 10:a=e.sent,c.push(new Promise((function(e){chrome.tabs.onUpdated.addListener((function t(r,n){"complete"===n.status&&r===a.id&&(chrome.tabs.onUpdated.removeListener(t),e(!0))}))})));case 12:i.set(n,null===(r=a)||void 0===r?void 0:r.id);case 13:case"end":return e.stop()}}),e)})),p=$(s);case 13:return e.next=15,p.next();case 15:if(!(u=!(d=e.sent).done)){e.next=20;break}return e.delegateYield(h(),"t0",17);case 17:u=!1,e.next=13;break;case 20:e.next=26;break;case 22:e.prev=22,e.t1=e.catch(10),l=!0,f=e.t1;case 26:if(e.prev=26,e.prev=27,!u||null==p.return){e.next=31;break}return e.next=31,p.return();case 31:if(e.prev=31,!l){e.next=34;break}throw f;case 34:return e.finish(31);case 35:return e.finish(26);case 36:return e.next=38,Promise.all(c);case 38:return e.next=40,_(2e3);case 40:m=!1,v=!1,e.prev=42,y=$(s);case 44:return e.next=46,y.next();case 46:if(!(m=!(b=e.sent).done)){e.next=61;break}return w=b.value,x=w.url,k=i.get(x),e.next=52,chrome.tabs.update(k,{highlighted:!0});case 52:return e.next=54,chrome.tabs.sendMessage(k,{type:"run-reeval",options:w});case 54:return e.next=56,_(I(w.time_end).diff(I(w.time_start)));case 56:return e.next=58,chrome.tabs.update(k,{highlighted:!1});case 58:m=!1,e.next=44;break;case 61:e.next=67;break;case 63:e.prev=63,e.t2=e.catch(42),v=!0,g=e.t2;case 67:if(e.prev=67,e.prev=68,!m||null==y.return){e.next=72;break}return e.next=72,y.return();case 72:if(e.prev=72,!v){e.next=75;break}throw g;case 75:return e.finish(72);case 76:return e.finish(67);case 77:e.next=82;break;case 79:e.prev=79,e.t3=e.catch(7),console.error(e.t3);case 82:if("reeval-storyboard"!==o){e.next=128;break}return E=a.storyboard,T=E.sections,e.next=87,C(chrome.windows.WindowState.FULLSCREEN);case 87:O=e.sent,j=[],S=!1,P=!1,e.prev=91,N=z().mark((function e(){var t,r,n,o,a,i,c;return z().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=X(D.value,2),r=t[0],n=t[1],a=null==n||null===(o=n.screen_recording)||void 0===o?void 0:o.url,n.inx=r,!a){e.next=11;break}return i=et(a,r),e.next=7,chrome.tabs.create({url:i,active:!r,windowId:O.id});case 7:c=e.sent,n.tabId=c.id,n.url=i,j.push(new Promise((function(e){chrome.tabs.onUpdated.addListener((function t(r,n){"complete"===n.status&&r===c.id&&(chrome.tabs.onUpdated.removeListener(t),e(!0))}))})));case 11:case"end":return e.stop()}}),e)})),U=$(Object.entries(T));case 94:return e.next=96,U.next();case 96:if(!(S=!(D=e.sent).done)){e.next=101;break}return e.delegateYield(N(),"t4",98);case 98:S=!1,e.next=94;break;case 101:e.next=107;break;case 103:e.prev=103,e.t5=e.catch(91),P=!0,A=e.t5;case 107:if(e.prev=107,e.prev=108,!S||null==U.return){e.next=112;break}return e.next=112,U.return();case 112:if(e.prev=112,!P){e.next=115;break}throw A;case 115:return e.finish(112);case 116:return e.finish(107);case 117:return j.push(M(O.id)),e.next=120,Promise.all(j);case 120:return e.next=122,L({windowId:O.id});case 122:return R=e.sent,console.log(R),e.next=126,chrome.storage.local.set({activeTab:R.id});case 126:return e.next=128,chrome.tabs.sendMessage(R.id,{type:"reeval-start-recording",options:a});case 128:if("reeval-run-storyboard"!==o){e.next=186;break}return e.prev=129,console.log("reeval-run-storyboard --\x3e> ",a),e.next=133,_(3e3);case 133:q=null!==(F=null==a||null===(G=a.storyboard)||void 0===G?void 0:G.sections)&&void 0!==F?F:[],Y=!1,W=!1,e.prev=136,H=$(q);case 138:return e.next=140,H.next();case 140:if(!(Y=!(J=e.sent).done)){e.next=157;break}if(K=J.value,Z=K.tabId,Q=K.inx,ee=K.screen_recording,!Z){e.next=154;break}return e.next=146,chrome.tabs.update(Z,{highlighted:!0});case 146:return e.next=148,chrome.tabs.sendMessage(Z,{type:"run-reeval",options:ee});case 148:return re=null!==(te=null==ee?void 0:ee.duration)&&void 0!==te?te:5e3,console.log(Q,"---\x3e>>",null==ee?void 0:ee.duration),e.next=152,_(re);case 152:return e.next=154,chrome.tabs.update(Z,{highlighted:!1});case 154:Y=!1,e.next=138;break;case 157:e.next=163;break;case 159:e.prev=159,e.t6=e.catch(136),W=!0,B=e.t6;case 163:if(e.prev=163,e.prev=164,!Y||null==H.return){e.next=168;break}return e.next=168,H.return();case 168:if(e.prev=168,!W){e.next=171;break}throw B;case 171:return e.finish(168);case 172:return e.finish(163);case 173:return e.next=175,chrome.runtime.sendMessage({type:"stop-recording-tab"});case 175:return e.next=177,chrome.windows.getCurrent();case 177:return ne=e.sent,oe=ne.id,e.next=181,chrome.windows.update(oe,{state:chrome.windows.WindowState.MAXIMIZED});case 181:e.next=186;break;case 183:e.prev=183,e.t7=e.catch(129),console.log("reeval-run-storyboard",e.t7);case 186:if("reeval-start-recording-test"!==o){e.next=192;break}return e.next=189,L();case 189:return ae=e.sent,e.next=192,chrome.tabs.sendMessage(ae.id,{type:"toggle-popup"});case 192:case"end":return e.stop()}}),e,null,[[7,79],[10,22,26,36],[27,,31,35],[42,63,67,77],[68,,72,76],[91,103,107,117],[108,,112,116],[129,183],[136,159,163,173],[164,,168,172]])})));return function(t,r,n){return e.apply(this,arguments)}}())}},(function(e){e.h=()=>"f6c134161eead1ad1278"}));